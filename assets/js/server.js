$(document).ready(function(){function t(){var t="";$.ajax({type:"GET",url:n+"koffee/load_most_played",dataType:"json",success:function(a){a.length>0?$.each(a,function(a,e){t+='<img src="'+e.album_art+'" alt="'+e.title+'" data-toggle="tooltip" data-placement="bottom" data-artist="'+e.artist+'" data-title="'+e.title+'" class="img-responsive img-circle most-played-thumb">'}):t='<li style="padding-top: 7px; color: white"><small><i class="fa fa-circle-o"></i>&nbsp;&nbsp;Play your favorite tracks and directly access it here.</small></li style="padding-top: 7px; color: white">',s.html(t)}}).fail(function(){alert("Something went wrong.")})}var a=$("#signup-banner"),e=$("#login-banner"),n=$("#base-url").val();$("#signup").on("submit",function(t){var e=$(this).serialize();$.ajax({type:"POST",url:n+"koffee/add_user",dataType:"json",data:e,success:function(t){t.added?$("#signup-banner").text("Successful!"):t.empty?$("#signup-banner").text("Please provide the necessary fields."):0==t.passwordNotMatched&&$("#signup-banner").text("Password not match")}}).fail(function(){a.text("Something went wrong.")}),t.preventDefault()}),$("#login").on("submit",function(){var t=$(this).serialize();$.ajax({type:"POST",url:n+"koffee/login",data:t,dataType:"json",success:function(t){t.user?(window.location.href=n+"koffee/mood",$("nav").hide()):e.text("Wrong username or password.")}}).fail(function(){a.text("Something went wrong.")})}),$("#update-mood").on("submit",function(t){var a=$(this).serialize();$.ajax({type:"POST",url:n+"koffee/update_mood",data:a,dataType:"json",success:function(t){t.success&&(window.location.href=n+"koffee/app")}}).fail(function(){alert("Something went wrong.")}),t.preventDefault()}),$("#count-song").on("submit",function(t){var a=$(this).serialize();$.ajax({type:"POST",url:n+"koffee/new_song_count",data:a,dataType:"json",success:function(t){t.success}}).fail(function(){alert("Something went wrong")}),t.preventDefault()});var s=$("#most-played");t(),setInterval(t,15e3),setTimeout(function(){var t=[],a=[];$.ajax({type:"GET",url:n+"koffee/load_most_played",dataType:"json",success:function(e){$.each(e,function(e,n){t.push(n.play),a.push(n.title)})}}).fail(function(){alert("Something went wrong.")});var e=document.getElementById("myChart").getContext("2d");new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"# Airplay",data:t,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}(),2e3),setTimeout(function(){var t=[],a=[];$.ajax({type:"GET",url:n+"koffee/get_weekly_trend",dataType:"json",success:function(e){$.each(e,function(e,n){t.push(n.songs_played),a.push(n.weekd)})}}).fail(function(){alert("Something went wrong.")});var e=document.getElementById("myChartweekly").getContext("2d");new Chart(e,{type:"line",filled:!0,data:{labels:a,datasets:[{label:"# Airplay",data:t,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}(),2e3);var r=$("#recommendations-body");!function(){var t="";$.ajax({type:"GET",url:n+"koffee/load_recommendations",dataType:"json",success:function(a){if(0==a.length)t+=`\n\t\t\t\t\t<div id="placeholder">\n\t\t\t\t\t\t\t\t<h1 class="light-font text-center">Recommendations are not available</h1>\n\t\t\t\t\t\t\t\t<p class="text-center">Recommendations are based on your interactions with your songs in your playlists.</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t`;else{t+='<div class="row">';var e=0;$.each(a,function(a,n){t+=`\n\t\t\t\t\t\t\t<div class="col-lg-3">\n\t\t\t\t\t\t\t\t<div class="song-thumb-parent center-block">\n\t\t\t\t\t\t\t\t\t<div class="thumb-bg" style='background-image: url(`+n.album_art+`)'>\n\t\t\t\t\t\t\t\t\t\t<p>`+n.artist+`&nbsp;&nbsp;&#8226;&nbsp;&nbsp;`+n.year+`</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="thumb-label">\n\t\t\t\t\t\t\t\t\t\t<h5>`+n.title+`</h5>\n\t\t\t\t\t\t\t\t\t\t<span class="play-btn" data-title="`+n.title+`" data-artist="`+n.artist+`">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-play"></i>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t`,t+=++e%4==0?"</div><div class='row'>":""})}r.html(t)}}).fail(function(){alert("Something went wrong.")})}(),function(){var t="";$.ajax({type:"GET",url:n+"koffee/load_discovery",dataType:"json",success:function(a){if(0==a.length)t+=`\n\t\t\t\t\t<div id="placeholder">\n\t\t\t\t\t\t\t\t<h1 class="light-font text-center">Discover music is not available</h1>\n\t\t\t\t\t\t\t\t<p class="text-center">Interact with your playlist to discovery more of your songs.</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t`;else{t+='<div class="row">';var e=0;$.each(a,function(a,n){t+=`\n\t\t\t\t\t\t\t<div class="col-lg-3">\n\t\t\t\t\t\t\t\t<div class="song-thumb-parent center-block">\n\t\t\t\t\t\t\t\t\t<div class="thumb-bg" style='background-image: url(`+n.album_art+`)'>\n\t\t\t\t\t\t\t\t\t\t<p>`+n.artist+`&nbsp;&nbsp;&#8226;&nbsp;&nbsp;`+n.year+`</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="thumb-label">\n\t\t\t\t\t\t\t\t\t\t<h5>`+n.title+`</h5>\n\t\t\t\t\t\t\t\t\t\t<span class="play-btn" data-title="`+n.title+`" data-artist="`+n.artist+`">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-play"></i>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t`,t+=++e%4==0?"</div><div class='row'>":""})}$("#discovery-body").html(t)}}).fail(function(){alert("Something went wrong")})}();var o=$("#results");o.hide(),$("#search-song").on("keyup",function(){var t="";$.ajax({type:"GET",url:n+"koffee/search_song/"+$("#search-song").val(),dataType:"json",success:function(a){""!=$("#search-song").val()&&a&&$.each(a,function(a,e){t+='<p class="search-result" data-artist="'+e.artist+'"><img src="'+e.album_art+'" class="list-group-thumb img-responsive" alt="" />'+e.title+"</p>"}),setTimeout(function(){o.html(t).slideDown()},1e3)}}).fail(function(){alert("Something went wrong.")})}),$("#results").on("click",".search-result",function(){var t=$("#search-song");t.val($(this).text()),t.attr("data-artist",$(this).attr("data-artist")),t.attr("data-album-art",$(this).find("img").attr("src")),o.slideUp()})});